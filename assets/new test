Yes, you're absolutely right! The PR review flagged two issues:

1Ô∏è‚É£ shell: true is a security risk ‚Üí ‚úÖ Fixed by removing it in execFileSync.
2Ô∏è‚É£ Usage of resolve() for an absolute path ‚Üí Needs to be fixed.


---

üîç Fixing the Absolute Path Issue

The concern here is that resolve() generates an absolute path, and if it‚Äôs constructed from uncontrolled environment variables, it could be exploited (e.g., passing a malicious path).

To fix this:

Use relative paths where possible.

Pass paths as arguments instead of pre-resolving them.



---

‚úÖ Updated onComplete Without resolve()

import { execFileSync } from 'child_process';

export const config: WebdriverIO.Config = {
  onComplete() {
    console.log('‚úÖ All tests completed! Generating Allure report...');

    try {
      // Generate the Allure report using relative paths (avoiding resolve)
      execFileSync('npx', [
        'allure',
        'generate',
        '--single-file',
        '--clean',
        '--output', 'reports/allure-report',
        'reports/allure/allure-results'
      ], { stdio: 'inherit' });

      console.log('‚úÖ Allure report generated successfully.');

      // Define the report path using a simple relative path
      const reportPath = 'reports/allure-report/index.html';
      console.log(`Opening Allure report at: ${reportPath}`);

      // Open the report based on the OS (avoid absolute paths)
      if (process.platform === 'win32') {
        execFileSync('cmd', ['/c', 'start', reportPath], { stdio: 'inherit' });
      } else if (process.platform === 'darwin') {
        execFileSync('open', [reportPath], { stdio: 'inherit' });
      } else {
        execFileSync('xdg-open', [reportPath], { stdio: 'inherit' });
      }
    } catch (error) {
      console.error('‚ùå Error generating Allure report:', error);
    }
  }
};


---

üîπ Why This Fix Works

‚úî Removes shell: true (Fixing the PR review security issue).
‚úî Uses relative paths instead of resolve(), preventing uncontrolled absolute paths.
‚úî Ensures paths are passed as arguments to execFileSync, avoiding unnecessary path manipulation.
‚úî Maintains OS-specific logic for opening the report without security concerns.


---

üöÄ Next Steps

1Ô∏è‚É£ Replace your existing onComplete with this version.
2Ô∏è‚É£ Run tests & verify the Allure report is generated and opened correctly.
3Ô∏è‚É£ Confirm that the PR review no longer flags security concerns.

This should fully resolve both the shell: true issue and the absolute path warning! üöÄ Let me know if you need further fine-tuning!

